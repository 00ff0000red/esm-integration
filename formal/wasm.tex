\documentclass[a4paper]{scrartcl}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xspace}
\usepackage{color}

\newcommand\void[1]{}


% Calculus notation

\newcommand\x[1]{\ensuremath{\mathit{#1}}\xspace}
\newcommand\f[1]{\ensuremath{\mathop{\mathrm{#1\null}}\nolimits}\xspace}
\newcommand\ff[1]{\ensuremath{\mathbin{\mathrm{#1\null}}}\xspace}
\newcommand\y[1]{\ensuremath{{}\hspace{-0.25em}\mathrel{\mathsf{#1\null}}}\xspace}
\newcommand\yy[1]{\ensuremath{\mathrel{\mathsf{#1\null}}}\xspace}

\renewcommand\vec[1]{\overline{#1}}
\newcommand\tup[1]{\langle#1\rangle}

\newcommand\append{\mathbin{{+\!\!+}}}
\newcommand\wild{\mathbin{{\_\!\_}}}

\newcommand\too{\Rightarrow}
\newcommand\evalto{\hookrightarrow}
\newcommand\elabto{\rightsquigarrow}
\newcommand\elabtox[1]{\stackrel{#1}\rightsquigarrow}
\newcommand{\yields}{\uparrow}
\newcommand{\antype}{:_\Leftarrow}
\newcommand{\syntype}{:_\Rightarrow}
\newcommand{\ansub}{\leq_\Leftarrow}
\newcommand{\synsub}{\leq_\Rightarrow}

\newcommand\LET{\y{let}}
\newcommand\PACK{\y{pack}}
\newcommand\UNPACK{\y{unpack}}
\newcommand\WRAP{\y{wrap}}
\newcommand\UNWRAP{\y{unwrap}}
\newcommand\NEW{\y{new}}
\newcommand\IN{\yy{in}}
\newcommand\AS{\yy{as}}
\newcommand\CAST{\y{cast}}
\newcommand\NAM{{\y{nam}}}
\newcommand\BOOL{{\y{bool}}}
\newcommand\TRUE{{\y{true}}}
\newcommand\FALSE{{\y{false}}}
\newcommand\IF{\y{if}}
\newcommand\THEN{\yy{then}}
\newcommand\ELSE{\yy{else}}
\newcommand\CASE{\y{case}}
\newcommand\OF{\yy{of}}

\newcommand{\VAL}{\K{val}}
\newcommand{\TYP}{\K{typ}}
\newcommand{\SIG}{\K{sig}}

\newcommand\Dom{\ff{dom}}
\newcommand\Rng{\ff{rng}}
\newcommand\FTV{\ff{fv}}
\newcommand\Norm{\ff{norm}}

\newcommand\conty{\chi}
\newcommand\pathty{\pi}
\newcommand\smallty{\sigma}
\newcommand\bigty{\Sigma}
\newcommand\polyty{\Phi}
\newcommand\absty{\Xi}

\newcommand\emptysubst{\f{id}}

\newcommand\Rho{{\f{R}}}
\newcommand\pure{{\f{P}}}
\newcommand\impure{{\f{I}}}

\newcommand\deter{\epsilon}
\newcommand\anal{{\f{an}}}
\newcommand\synth{{\f{syn}}}
\newcommand\inst{{\f{ins}}}


% Code notation

\newcommand\K[1]{\ensuremath{\textsf{#1}}}
%\newcommand\K[1]{\ensuremath{\texttt{#1}}}
\newcommand\KK[1]{\ensuremath{\K{\textbf{#1}}}}

\newcommand\Kback{\ensuremath{\backslash\!}}
\newcommand\Kto{\ensuremath{\rightarrow}\xspace}
\newcommand\Ktoo{\ensuremath{\Rightarrow}\xspace}
\newcommand\Kfrom{\ensuremath{\leftarrow}\xspace}
\newcommand\Kfroom{\ensuremath{\Leftarrow}\xspace}
\newcommand\Ktimes{\ensuremath{\times}\xspace}
\newcommand\Kappend{\ensuremath{\append}\xspace}
\newcommand\Kwild{\ensuremath{\wild}\xspace}
\newcommand\Kbar{\ensuremath{|}\xspace}
\newcommand\Kneq{\ensuremath{\neq}\xspace}
\newcommand\Kleq{\ensuremath{\leq}\xspace}
\newcommand\Klt{\ensuremath{<}\xspace}
\newcommand\Kgt{\ensuremath{>}\xspace}
\newcommand\Kseal{\ensuremath{:>}\xspace}
\newcommand\Kdot{\ensuremath{\cdot}\xspace}
\newcommand\Kcirc{\ensuremath{\circ}\xspace}
\newcommand\Kalpha{\ensuremath{\alpha}}
\newcommand\Kbeta{\ensuremath{\beta}}
\newcommand\Kgamma{\ensuremath{\gamma}}
\newcommand\Klangle{\ensuremath{\langle}}
\newcommand\Krangle{\ensuremath{\rangle}}
\newcommand\Ksb[1]{\ensuremath{_{#1}}}

\DeclareTextCommand{\_}{OT1}{\leavevmode \kern.06em\vbox{\hrule width.6em}}


% Coloring

%\definecolor{hilite}{rgb}{0,0,0.9}
\definecolor{hilite}{rgb}{0.7,0,0}
\newcommand{\hilite}[1]{\color{hilite}#1\color{black}}


\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Wasm-as-stack}


\subsection*{Syntax}

$$
\begin{array}{@{}llcl@{}}
\text{(types)} & t &::=&
  \KK{i32} ~|~
  \KK{i64} ~|~
  \KK{f32} ~|~
  \KK{f64} \\
[1ex]
\text{(operators)} & e &::=&
  t\KK{.const}~c ~|~
  t\KK{.}\x{unop} ~|~
  t\KK{.}\x{binop} ~|~
  t\KK{.}\x{testop} ~|~
  t\KK{.}\x{relop} ~|~
  \dots ~|~ \\&&&
  \KK{unreachable} ~|~
  \KK{nop} ~|~
  \KK{drop} ~|~
  \KK{select} ~|~
  \KK{get}~i ~|~
  \KK{set}~i ~|~
  \KK{tee}~i ~|~ \\&&&
  \KK{block}~e^\ast~\KK{end} ~|~
  \KK{loop}~e^\ast~\KK{end} ~|~
  \KK{if}~e_1^\ast~\KK{else}~e_2^\ast~\KK{end} ~|~ \\&&&
  \KK{br}_n~i ~|~
  \KK{br\_if}_n~i ~|~
  \KK{br\_table}_n~i^+ ~|~
  \KK{call}_n~i ~|~
  \KK{return}_n \\
\end{array}
$$

%\newcommand\orbot{/\bot}
%\newcommand\poly[1]{\bot}
%\newcommand\botrule[1]{#1}

\newcommand\orbot{}
\newcommand\poly[1]{[#1]}
\newcommand\botrule[1]{}


\subsection*{Typing Operators \hfill $\boxed{C \vdash e : [t^\ast] \to [t^?]\orbot}$}

$$
\frac{
}{
  C \vdash t\KK{.const}~c : [] \to [t]
}
$$

$$
\frac{
}{
  C \vdash t\KK{.}\x{unop} : [t] \to [t]
}
%$$
\qquad
%$$
\frac{
}{
  C \vdash t\KK{.}\x{binop} : [t~t] \to [t]
}
$$

$$
\frac{
}{
  C \vdash t\KK{.}\x{testop} : [t] \to [\K{i32}]
}
%$$
\qquad
%$$
\frac{
}{
  C \vdash t\KK{.}\x{relop} : [t~t] \to [\K{i32}]
}
$$

$$
\frac{
}{
  C \vdash \KK{nop} : [] \to []
}
%$$
\qquad
%$$
\frac{
}{
  C \vdash \KK{drop} : [t] \to []
}
%$$
\qquad
%$$
\frac{
}{
  C \vdash \KK{select} : [t~t~\K{i32}] \to [t]
}
$$

$$
\frac{
  C_{\f{local}}(i) = t
}{
  C \vdash \KK{get}~i : [] \to [t]
}
%$$
\qquad
%$$
\frac{
  C_{\f{local}}(i) = t
}{
  C \vdash \KK{set}~i : [t] \to []
}
%$$
\qquad
%$$
\frac{
  C_{\f{local}}(i) = t
}{
  C \vdash \KK{tee}~i : [t] \to [t]
}
$$

$$
\frac{
  C,_{\f{label}}[t^?] \vdash e^\ast : [t^?]\orbot
}{
  C \vdash \KK{block}~e^\ast~\KK{end} : [] \to [t^?]\orbot
}
%$$
\qquad
%$$
\frac{
  C,_{\f{label}}[] \vdash e^\ast : [t^?]\orbot
}{
  C \vdash \KK{loop}~e^\ast~\KK{end} : [] \to [t^?]\orbot
}
$$

$$
\frac{
  C \vdash e_1^\ast : [t^?]\orbot
  \qquad
  C \vdash e_2^\ast : [t^?]\orbot
}{
  C \vdash \KK{if}~e_1^\ast~\KK{else}~e_2^\ast~\KK{end} : [\K{i32}] \to [t^?]\orbot
}
$$

$$
\frac{
  C_{\f{label}}(i) = [t^n]
}{
  C \vdash \KK{br}_n~i : [t^n] \to \poly{t_0^?}
}
%$$
\qquad
%$$
\frac{
  C_{\f{label}}(i) = [t^n]
}{
  C \vdash \KK{br\_if}_n~i : [t^n~\K{i32}] \to [t^n]
}
$$
%\qquad
$$
\frac{
  (C_{\f{label}}(i) = [t^n])^+
}{
  C \vdash \KK{br\_table}_n~i^+ : [t^n~\K{i32}] \to \poly{t_0^?}
}
%$$
\qquad
%$$
\frac{
}{
  C \vdash \KK{unreachable} : [] \to \poly{t^?}
}
$$

$$
\frac{
  C_{\f{func}}(i) = [t_1^n] \to [t_2^?]
}{
  C \vdash \KK{call}_n~i^+ : [t_1^n] \to [t_2^?]
}
%$$
\qquad
%$$
\frac{
  C_{\f{return}} = [t^n]
}{
  C \vdash \KK{return}_n : [t^n] \to \poly{t_0^?}
}
$$


\subsection*{Typing Sequences \hfill $\boxed{C \vdash e^\ast : [t^\ast]\orbot}$}

$$
\frac{
}{
  C \vdash \epsilon : []
}
%$$
\qquad
%$$
\frac{
  C \vdash e^\ast : [t_1^\ast~t_2^\ast]
  \qquad
  C \vdash e_2 : [t_2^\ast] \to [t_3^?]\orbot
}{
  C \vdash e^\ast~e_2 : [t_1^\ast~t_3^?]\orbot
}
\botrule{
%$$
\qquad
%$$
\frac{
  C \vdash e^\ast : \bot
  \qquad
  C \vdash e_2 : [t_2^\ast] \to [t_3^?]/\bot
}{
  C \vdash e^\ast~e_2 : \bot
}
}
$$


\subsection*{Reduction \hfill $\boxed{S;~e^\ast \evalto S;~e^\ast}$}

$$
\begin{array}{@{}llcl@{}}
\text{(values)} & v &::=&
  t\KK{.const}~c \\
\text{(administrative operators)} & e &::=&
  \dots ~|~
  \KK{trap} ~|~
  \KK{label}[e^\ast]~e^\ast~\KK{end} ~|~
  \KK{local}[v^\ast]~e^\ast~\KK{end} \\
\text{(local contexts)} & L &::=&
  [] ~|~
  v^\ast~L~e^\ast ~|~
  \KK{label}[e^\ast]~L~\KK{end} \\
\text{(evaluation contexts)} & E &::=&
  [] ~|~
  v^\ast~E~e^\ast ~|~
  \KK{label}[e^\ast]~E~\KK{end} ~|~
  \KK{local}[v^\ast]~E~\KK{end} \\
\end{array}
$$

$$
\frac{
  S;~e^\ast \evalto S';~{e'}^\ast
}{
  S;~E[e^\ast] \evalto S';~E[{e'}^\ast]
}
%$$
\qquad
%$$
\frac{
}{
  S;~E[\KK{trap}] \evalto S;~\KK{trap}
}
$$


$$
\begin{array}{rcl}
(t.\KK{const}~c)~t\KK{.}\x{unop} &\evalto&
  t.\KK{const}~t.\x{unop}(c) \\
(t.\KK{const}~c_1)~(t.\KK{const}~c_2)~t\KK{.}\x{binop} &\evalto&
  t.\KK{const}~t.\x{binop}(c_1, c_2) \\
(t.\KK{const}~c)~t\KK{.}\x{testop} &\evalto&
  \KK{i32.const}~t.\x{testop}(c) \\
(t.\KK{const}~c_1)~(t.\KK{const}~c_2)~t\KK{.}\x{binop} &\evalto&
  \KK{i32.const}~t.\x{relop}(c_1, c_2) \\
[1ex]
\KK{unreachable} &\evalto&
  \KK{trap} \\
\KK{nop} &\evalto&
  \epsilon \\
v~\KK{drop} &\evalto&
  \epsilon \\
v_1~v_2~(\KK{i32.const}~0)~\KK{select} &\evalto&
  v_2 \\
v_1~v_2~(\KK{i32.const}~i+1)~\KK{select} &\evalto&
  v_1 \\
[1ex]
\void{
\KK{block}~v^\ast~\KK{end} &\evalto&
  v^\ast \\
\KK{block}~v^\ast~v^n~(\KK{br}_n~0)~e^\ast~\KK{end} &\evalto&
  v^n \\
\KK{block}~v^\ast~v^n~(\KK{br}_n~i+1)~e^\ast~\KK{end} &\evalto&
 v^n~(\KK{br}_n~i) \\
[1ex]
\KK{loop}~e^\ast~\KK{end} &\evalto&
  \KK{block}~e^\ast~\KK{end}~\KK{loop}~e^\ast~\KK{end} \\
[1ex]
}
(\KK{i32.const}~0)~\KK{if}~e_1^\ast~\KK{else}~e_2^\ast~\KK{end} &\evalto&
  e_2^\ast \\
(\KK{i32.const}~i+1)~\KK{if}~e_1^\ast~\KK{else}~e_2^\ast~\KK{end} &\evalto&
  e_1^\ast \\
[2ex]
(\KK{i32.const}~0)~(\KK{br\_if}_n~i) &\evalto&
  \epsilon \\
(\KK{i32.const}~j+1)~(\KK{br\_if}_n~i) &\evalto&
  \KK{br}_n~i \\
(\KK{i32.const}~k)~(\KK{br\_table}_n~i_1^k~i~i_2^\ast) &\evalto&
  \KK{br}_n~i \\
(\KK{i32.const}~k+j)~(\KK{br\_table}_n~i_1^k~i) &\evalto&
  \KK{br}_n~i \\
[1ex]
\KK{block}~e^\ast~\KK{end} &\evalto&
  \KK{label}[]~e^\ast~\KK{end} \\
\KK{loop}~e^\ast~\KK{end} &\evalto&
  \KK{label}[\KK{loop}~e^\ast~\KK{end}]~e^\ast~\KK{end} \\
[1ex]
\KK{label}[e^\ast]~v^\ast~\KK{end} &\evalto&
  v^\ast \\
\KK{label}[e_0^\ast]~v^\ast~v^n~(\KK{br}_n~0)~e^\ast~\KK{end} &\evalto&
  v^n~e_0^\ast \\
\KK{label}[e_0^\ast]~v^\ast~v^n~(\KK{br}_n~i+1)~e^\ast~\KK{end} &\evalto&
  v^n~(\KK{br}_n~i) \\
%\KK{label}[e_0^\ast]~v^\ast~v^n~\KK{return}_n~e^\ast~\KK{end} &\evalto&
%  v^n~\KK{return}_n \\
%\KK{label}[e_0^\ast]~v^\ast~\KK{unreachable}~e^\ast~\KK{end} &\evalto&
%  \KK{unreachable} \\
[1ex]
S;~ v^n~\KK{call}_n~i &\evalto&
  S;~ \KK{local}[v^n~S_{\f{func}}(i).{\f{locals}}]~S_{\f{func}}(i).{\f{body}}~\KK{end} \\
\KK{local}[v_l^\ast]~v^\ast~\KK{end} &\evalto&
  v^\ast \\
%\KK{local}[v_l^\ast]~v^\ast~v^n~\KK{return}_n~e^\ast~\KK{end} &\evalto&
%  v^n \\
\KK{local}[v_l^\ast]~L[v^n~\KK{return}_n]~\KK{end} &\evalto&
  v^n \\
%\KK{local}[v_l^\ast]~v^\ast~\KK{unreachable}~e^\ast~\KK{end} &\evalto&
%  \KK{unreachable} \\
[2ex]
\void{
S;~ (\KK{get}~i) &\evalto&
  S;~ S_{\f{local}}(i) \\
S;~ v~(\KK{set}~i) &\evalto&
  S,i=v;~ \epsilon \\
v~(\KK{tee}~i) &\evalto&
  v~v~(\KK{set}~i) \\
[1ex]
}
\KK{local}[v_1^i~v~v_2^\ast]~L[\KK{get}~i]~\KK{end} &\evalto&
  \KK{local}[v_1^i~v~v_2^\ast]~L[v]~\KK{end} \\
\KK{local}[v_1^i~v~v_2^\ast]~L[v'~(\KK{set}~i)]~\KK{end} &\evalto&
  \KK{local}[v_1^i~v'~v_2^\ast]~L[\epsilon]~\KK{end} \\
v~(\KK{tee}~i) &\evalto&
  v~v~(\KK{set}~i) \\
[1ex]
\end{array}
$$

{
$$
\frac{
}{
  C \vdash \KK{trap} : [] \to \poly{t^\ast}
}
%$$
\qquad
%$$
\frac{
  C \vdash e_0^\ast : [t^\ast]\orbot
  \qquad
  C \vdash e^\ast : [t^\ast]\orbot
}{
  C \vdash \KK{label}[e_0^\ast]~e^\ast~\KK{end} : [] \to [t^\ast]\orbot
}
%$$
\qquad
%$$
\frac{
  (\vdash v : t_v)^\ast
  \qquad
  C,_{\f{local}}t_v^\ast \vdash e^\ast : [t^\ast]\orbot
}{
  C \vdash \KK{local}[v^\ast]~e^\ast~\KK{end} : [] \to [t^\ast]\orbot
}
$$
}

\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\void{
\subsection*{Evaluating Expressions \hfill $\boxed{[c^\ast]~e \too r}$}

$$
\begin{array}{@{}llcl@{}}
\text{(results)} & r &::=&
  [c^*] ~|~
  \K{br}~i~[c^*] \\
\end{array}
$$

$$
\frac{
}{
  []~t\KK{.const}~c \too [c]
}
%$$
\qquad
%$$
\frac{
}{
  [c]~t\KK{.}\x{unop} \too [t.\x{unop}(c)]
}
\qquad
%$$
\frac{
}{
  [c_1~c_2]~t\KK{.}\x{binop} \too [t.\x{binop}(c_1, c_2)]
}
$$

$$
\frac{
  e^\ast \too [c^?]
}{
  []~\KK{block}~e^\ast~\KK{end} \too [c^?]
}
%$$
\qquad
%$$
\frac{
  e^\ast \too \K{br}~0~[c^?]
}{
  []~\KK{block}~e^\ast~\KK{end} \too [c^?]
}
%$$
\qquad
%$$
\frac{
  e^\ast \too \K{br}~(i+1)~[c^?]
}{
  []~\KK{block}~e^\ast~\KK{end} \too \K{br}~i~[c^?]
}
$$

$$
\frac{
  e^\ast \too [c^?]
}{
  []~\KK{loop}~e^\ast~\KK{end} \too [c^?]
}
%$$
\qquad
%$$
\frac{
  e^\ast \too \K{br}~0~[]
  \qquad
  []~\KK{loop}~e^\ast~\KK{end} \too r
}{
  []~\KK{loop}~e^\ast~\KK{end} \too r
}
%$$
\qquad
%$$
\frac{
  e^\ast \too \K{br}~(i+1)~[c^?]
}{
  []~\KK{loop}~e^\ast~\KK{end} \too \K{br}~i~[c^?]
}
$$

$$
\frac{
  c \neq 0
  \qquad
  e_1^\ast \too r
}{
  [c]~\KK{if}~e_1^\ast~\KK{else}~e_2^\ast~\KK{end} \too r
}
%$$
\qquad
%$$
\frac{
  c = 0
  \qquad
  e_2^\ast \too r
}{
  [c]~\KK{if}~e_1^\ast~\KK{else}~e_2^\ast~\KK{end} \too r
}
$$

$$
\frac{
}{
  [c^n]~\KK{br}_n~i \too \K{br}~i~[c^n]
}
$$


\subsection*{Evaluating Sequences \hfill $\boxed{e^\ast \too r}$}

$$
\frac{
}{
  \epsilon \too []
}
%$$
\qquad
%$$
\frac{
  e^\ast \too [c_1^\ast~c_2^\ast]
  \qquad
  [c_2^\ast]~e_2 \too [c_3^?]
}{
  e^\ast~e_2 \too [c_1^\ast~c_3^?]
}
$$
%\qquad
$$
\frac{
  e^\ast \too \K{br}~i~[c^?]
}{
  e^\ast~e_2 \too \K{br}~i~[c^?]
}
%$$
\qquad
%$$
\frac{
  e^\ast \too [c_1^\ast~c_2^\ast]
  \qquad
  [c_2^\ast]~e \too \K{br}~i~[c^?]
}{
  e^\ast~e_2 \too \K{br}~i~[c^?]
}
$$
}


\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Wasm-as-stack, Flat}


\subsection*{Syntax}

$$
\begin{array}{@{}llcl@{}}
\text{(expressions)} & e &::=&
  t\KK{.const}~c ~|~
  t\KK{.}\x{unop} ~|~
  t\KK{.}\x{binop} ~|~
  \dots ~|~ \\&&&
  \KK{block} ~|~
  \KK{loop} ~|~
  \KK{if} ~|~
  \KK{else }~|~
  \KK{end} ~|~
  \KK{br}_n~i \\
[2ex]
\text{(control stacks)} & s &::=&
  b^* \\
\text{(control blocks)} & b &::=&
  [t^*]e\langle t^?\rangle \\
[2ex]
\text{(results)} & r &::=&
  [c^*] ~|~
  \K{br}~i~[c^*] \\
\end{array}
$$


\subsection*{Typing Expressions \hfill $\boxed{C \vdash e : s~[t^\ast] \to s~[t^?]}$}

$$
\begin{array}{@{}rcl@{}}
t\KK{.const}~c &:& s~[t_0^\ast] \to s~[t_0^\ast~t]
\\
t\KK{.}\x{unop} &:& s~[t_0^\ast~t] \to s~[t_0^\ast~t]
\\
t\KK{.}\x{binop} &:& s~[t_0^\ast~t~t] \to s~[t_0^\ast~t]
\\
\KK{block} &:& s~[t_0^\ast] \to s~[t_0^\ast]\K{block}\langle t^?\rangle~[]
\\
\KK{loop} &:& s~[t_0^\ast] \to s~[t_0^\ast]\K{loop}\langle t^?\rangle~[]
\\
\KK{if} &:& s~[t_0^\ast~\K{i32}] \to s~[t_0^\ast]\K{if}\langle t^?\rangle~[]
\\
\KK{end} &:& s~[t_0^\ast]e\langle t^?\rangle~[t^?] \to s~[t_0^\ast~t^?]
\\
\KK{else} &:& s~[t_0^\ast]\K{if}\langle t^?\rangle~[t^?] \to s~[t_0^\ast]\K{else}\langle t^?\rangle~[]
\\
\KK{br}_n~i &:& s~[t_0^\ast]\K{block}\langle t^n\rangle~b^i~[t_1^\ast~t^n] \to s~[t_0^\ast~t^n]
\\
\KK{br}_0~i &:& s~[t_0^\ast]\K{loop}\langle t^?\rangle~b^i~[t_1^\ast] \to s~[t_0^\ast]
\end{array}
$$


\subsection*{Typing Sequences \hfill $\boxed{C \vdash e^\ast : s~[t^\ast] \to s~[t^\ast]}$}

$$
\frac{
}{
  \epsilon : s~[] \to s~[]
}
%$$
\qquad
%$$
\frac{
  e_1^\ast : s_1~[t_1^\ast] \to s_2~[t_2^\ast]
  \qquad
  e_2 : s_2~[t_3^\ast] \to s_3~[t_3^\ast]
}{
  e_1^\ast~e_2 : s_1~[t_1^\ast] \to s_3~[t_3^\ast]
}
$$


\subsection*{Evaluating Expressions \hfill $\boxed{[c^\ast]~e \too r}$}

$$
\frac{
}{
  []~t\KK{.const}~c \too [c]
}
%$$
\qquad
%$$
\frac{
}{
  [c]~t\KK{.}\x{unop} \too [t.\x{unop}(c)]
}
\qquad
%$$
\frac{
}{
  [c_1~c_2]~t\KK{.}\x{binop} \too [t.\x{binop}(c_1, c_2)]
}
$$

$$
\frac{
}{
  []~\KK{block} \too [\K{block}]
}
%$$
\qquad
%$$
\frac{
  e^\ast \too \K{br}~0~[c^?]
}{
  []~\KK{block}~e^\ast~\KK{end} \too [c^?]
}
%$$
\qquad
%$$
\frac{
  e^\ast \too \K{br}~(i+1)~[c^?]
}{
  []~\KK{block}~e^\ast~\KK{end} \too \K{br}~i~[c^?]
}
$$

$$
\frac{
  e^\ast \too [c^?]
}{
  []~\KK{loop}~e^\ast~\KK{end} \too [c^?]
}
%$$
\qquad
%$$
\frac{
  e^\ast \too \K{br}~0~[]
  \qquad
  []~\KK{loop}~e^\ast~\KK{end} \too r
}{
  []~\KK{loop}~e^\ast~\KK{end} \too r
}
%$$
\qquad
%$$
\frac{
  e^\ast \too \K{br}~(i+1)~[c^?]
}{
  []~\KK{loop}~e^\ast~\KK{end} \too \K{br}~i~[c^?]
}
$$

$$
\frac{
  c \neq 0
  \qquad
  e_1^\ast \too r
}{
  [c]~\KK{if}~e_1^\ast~\KK{else}~e_2^\ast~\KK{end} \too r
}
%$$
\qquad
%$$
\frac{
  c = 0
  \qquad
  e_2^\ast \too r
}{
  [c]~\KK{if}~e_1^\ast~\KK{else}~e_2^\ast~\KK{end} \too r
}
$$

$$
\frac{
}{
  [c^n]~\KK{br}_n~i \too \K{br}~i~[c^n]
}
$$


\subsection*{Evaluating Sequences \hfill $\boxed{e^\ast \too r}$}

$$
\frac{
}{
  \epsilon \too []
}
%$$
\qquad
%$$
\frac{
  e^\ast \too [c_1^\ast~c_2^\ast]
  \qquad
  [c_2^\ast]~e_2 \too [c_3^?]
}{
  e^\ast~e_2 \too [c_1^\ast~c_3^?]
}
$$
%\qquad
$$
\frac{
  e^\ast \too \K{br}~i~[c^?]
}{
  e^\ast~e_2 \too \K{br}~i~[c^?]
}
%$$
\qquad
%$$
\frac{
  e^\ast \too [c_1^\ast~c_2^\ast]
  \qquad
  [c_2^\ast]~e \too \K{br}~i~[c^?]
}{
  e^\ast~e_2 \too \K{br}~i~[c^?]
}
$$


\end{document}
